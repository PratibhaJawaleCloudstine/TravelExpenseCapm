sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast"],function(e,t){"use strict";return e.extend("travel.travelexpenseui.controller.ReviewDraftRequest",{onInit:function(){this.getOwnerComponent().getRouter().getRoute("ReviewDraftRequest").attachPatternMatched(this._onRouteMatched,this)},_onRouteMatched:function(e){this.travelId=e.getParameter("arguments").travelId;console.log("Loaded Travel ID in _onRouteMatched :",this.travelId);this.getView().setBusy(true);const t=this.getOwnerComponent().getModel();const a=t.bindContext(`/TravelRequests(${this.travelId})`);a.requestObject().then(e=>{const t=new sap.ui.model.json.JSONModel(e);this.getOwnerComponent().setModel(t,"travelData");console.log("draft travel data");console.log(t);this.getView().setBusy(false)}).catch(e=>{console.error("Failed to fetch specific travel request:",e);sap.m.MessageBox.error("Error fetching data.")})},onReview:function(){const e=this.getView();const a={startDate:e.byId("rev_startDate").getDateValue(),endDate:e.byId("rev_endDate").getDateValue(),departure:e.byId("rev_departure").getSelectedItem().getText(),arrival:e.byId("rev_arrival").getSelectedItem().getText(),postingDate:e.byId("rev_postingDate").getDateValue(),selfTravel:e.byId("rev_selfTravel").getSelectedKey(),placeOfVisit:e.byId("rev_placeOfVisit").getValue(),travelType:e.byId("rev_travelType").getSelectedItem().getText(),purposeOfTravel:e.byId("rev_purposeOfTravel").getValue(),estimatedCosts:e.byId("rev_estimatedCosts").getValue(),additionalTravellers:e.byId("rev_additionalTravellers").getValue(),advances:e.byId("rev_advances").getValue(),costAssignment:parseInt(e.byId("rev_costAssignment").getText(),10)||0};console.log("estimatedCosts-- 63");console.log(estimatedCosts);console.log("Review Data:",a);t.show("Review data captured. Check console.")},onChangePlace:function(e){const t=e.getParameter("value");const a=e.getSource();const r=a.getItems();const s=r.some(e=>e.getText()===t);if(!s){console.log("User entered custom city:",t)}else{console.log("City selected from list:",t)}},onDateChange:function(){var e=this.byId("rev_startDate").getDateValue();var t=this.byId("rev_endDate").getDateValue();if(e&&t&&e>=t){this.byId("rev_startDate").setValueState("Error");this.byId("rev_endDate").setValueState("Error");this.byId("rev_startDate").setValueStateText("Start must be before End.");this.byId("rev_endDate").setValueStateText("End must be after Start.")}else{this.byId("rev_startDate").setValueState("None");this.byId("rev_endDate").setValueState("None")}},onReviewTravelRequest:function(){var e=this.getView().getModel();const t=this.getView();const r=t.byId("rev_startDate").getDateValue();if(!r||isNaN(r.getTime())){this.byId("rev_startDate").setValueState("Error");this.byId("rev_startDate").setValueStateText("start date is invalid or empty.");return}const s=t.byId("rev_endDate").getDateValue();if(!s||isNaN(s.getTime())){this.byId("rev_endDate").setValueState("Error");this.byId("rev_endDate").setValueStateText("end Date is invalid or empty.");return}var l=t.byId("rev_departure").getSelectedItem();var o=t.byId("rev_arrival").getSelectedItem();if(l!==null){var l=t.byId("rev_departure").getSelectedItem().getText()}else{this.byId("rev_departure").setValueState("Error");this.byId("rev_departure").setValueStateText("departure is empty or not selected.");return}if(o!==null){var o=t.byId("rev_arrival").getSelectedItem().getText()}else{this.byId("rev_arrival").setValueState("Error");this.byId("rev_arrival").setValueStateText("arrival is empty or not selected.");return}const i=t.byId("rev_postingDate").getDateValue();if(!i||isNaN(i.getTime())){this.byId("rev_postingDate").setValueState("Error");this.byId("rev_postingDate").setValueStateText("posting Date is invalid or empty.");return}const n=a(r);const d=a(s);const v=a(i);console.log(n);console.log(d);console.log(v);const u=t.byId("rev_selfTravel").getSelectedKey();const c=t.byId("rev_placeOfVisitComboBox").getValue();var g=parseInt(t.byId("rev_estimatedCosts").getValue(),10)||0;console.log("estimatedCosts-- 152");console.log(g);if(!c||c.trim()===""){this.byId("rev_placeOfVisitComboBox").setValueState("Error");this.byId("rev_placeOfVisitComboBox").setValueStateText("place Of Visit is empty.");return}var y=t.byId("rev_travelType").getSelectedItem();if(y!==null){y=t.byId("rev_travelType").getSelectedItem().getText()}else{this.byId("rev_travelType").setValueState("Error");this.byId("rev_travelType").setValueStateText("travel Type is empty or not selected.");return}var I=t.byId("rev_purposeOfTravel").getValue();const p=t.byId("rev_additionalTravellers").getValue();const b=t.byId("rev_advances").getValue();const m=t.byId("rev_costAssignment").getText();if(!u){this.byId("rev_selfTravel").setValueState("Error");this.byId("rev_selfTravel").setValueStateText("self Travel is empty or not selected.");return}if(!I){I=""}if(!g){g=0}var T="Review";const _={"@odata.context":"$metadata#TravelRequests/$entity",ID:f,employee:"EMP001",startDate:n,endDate:d,postingDate:v,selfTravel:u,placeOfVisit:c,estimatedCost:g,action:1,createdAt:(new Date).toISOString(),departure:l,arrival:o,travelType:y,purposeOfTravel:I,additionalTravellers:p,advances:b,costAssignment:m,status:T};console.log("estimatedCosts-- 212");console.log(g);const V=new sap.ui.model.json.JSONModel(_);this.getOwnerComponent().setModel(V,"travelData");console.log("empty travelId");var f="-";this.getOwnerComponent().getRouter().navTo("ReviewTravelScreen",{travelId:f})},onSaveDraft:function(){var e=this.getView().getModel();const t=this.getView();const a=t.byId("rev_startDate").getDateValue();if(!a||isNaN(a.getTime())){this.byId("rev_startDate").setValueState("Error");this.byId("rev_startDate").setValueStateText("start date is invalid or empty.");return}const r=a.toISOString().split("T")[0];const s=t.byId("rev_endDate").getDateValue();if(!s||isNaN(s.getTime())){this.byId("rev_endDate").setValueState("Error");this.byId("rev_endDate").setValueStateText("end Date is invalid or empty.");return}const l=s.toISOString().split("T")[0];var o=t.byId("rev_departure").getSelectedItem();var i=t.byId("rev_arrival").getSelectedItem();if(o!==null){var o=t.byId("rev_departure").getSelectedItem().getText()}else{this.byId("rev_departure").setValueState("Error");this.byId("rev_departure").setValueStateText("departure is empty or not selected.");return}if(i!==null){var i=t.byId("rev_arrival").getSelectedItem().getText()}else{this.byId("rev_arrival").setValueState("Error");this.byId("rev_arrival").setValueStateText("arrival is empty or not selected.");return}const n=t.byId("rev_postingDate").getDateValue();if(!n||isNaN(n.getTime())){this.byId("rev_postingDate").setValueState("Error");this.byId("rev_postingDate").setValueStateText("posting Date is invalid or empty.");return}const d=n.toISOString().split("T")[0];const v=t.byId("rev_selfTravel").getSelectedKey();const u=t.byId("rev_placeOfVisitComboBox").getValue();var c=parseInt(t.byId("rev_estimatedCosts").getValue(),10)||0;console.log("estimatedCosts-- 264");console.log(c);if(!u||u.trim()===""){this.byId("rev_placeOfVisitComboBox").setValueState("Error");this.byId("rev_placeOfVisitComboBox").setValueStateText("place Of Visit is empty.");return}var g=t.byId("rev_travelType").getSelectedItem();if(g!==null){g=t.byId("rev_travelType").getSelectedItem().getText()}else{this.byId("rev_travelType").setValueState("Error");this.byId("rev_travelType").setValueStateText("travel Type is empty or not selected.");return}var y=t.byId("rev_purposeOfTravel").getValue();const I=t.byId("rev_additionalTravellers").getValue();const p=t.byId("rev_advances").getValue();const b=t.byId("rev_costAssignment").getText();if(!v){this.byId("rev_selfTravel").setValueState("Error");this.byId("rev_selfTravel").setValueStateText("self Travel is empty or not selected.");return}if(!y){y=""}if(!c){c=0}var m=crypto.randomUUID();var T="Draft";this.getView().setBusy(true);var _=e.bindList("/TravelRequests",undefined,undefined,undefined,{$$updateGroupId:"travelGroup"});_.create({ID:m,employee:"EMP001",startDate:r,endDate:l,postingDate:d,selfTravel:v,placeOfVisit:u,estimatedCost:c,action:1,createdAt:(new Date).toISOString(),departure:o,arrival:i,travelType:g,purposeOfTravel:y,additionalTravellers:I,advances:p,costAssignment:b,status:T});e.submitBatch("travelGroup").then(()=>{sap.m.MessageToast.show("Travel request "+m+" saved successfully.");this.getOwnerComponent().getRouter().navTo("ReviewTravelScreen",{travelId:m});that.getOwnerComponent().getRouter().navTo("RouteCreateTravelRequest",true)}).catch(e=>{sap.m.MessageBox.error("Error saving travel request: "+e.message)}).finally(()=>{this.getView().setBusy(false)})}});function a(e){if(!e)return null;const t=e.getFullYear();const a=String(e.getMonth()+1).padStart(2,"0");const r=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${r}`}});
//# sourceMappingURL=ReviewDraftRequest.controller.js.map