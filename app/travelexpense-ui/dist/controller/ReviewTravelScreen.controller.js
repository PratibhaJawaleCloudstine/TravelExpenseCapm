sap.ui.define(["sap/ui/core/mvc/Controller"],function(e){"use strict";return e.extend("travel.travelexpenseui.controller.ReviewTravelScreen",{onInit:function(){this.getOwnerComponent().getRouter().getRoute("ReviewTravelScreen").attachPatternMatched(this._onRouteMatched,this)},onPreviousStep:function(){var e=sap.ui.core.routing.History.getInstance();var t=e.getPreviousHash();if(t!==undefined){window.history.go(-1)}else{this.getOwnerComponent().getRouter().navTo("RouteCreateTravelRequest",true)}},_onRouteMatched:function(e){this.travelId=e.getParameter("arguments").travelId;console.log("Loaded Travel ID:",this.travelId);if(this.travelId!=="-"){this.byId("id_saveDraftRadio").setEnabled(false);this.byId("id_saveAndApproveRadio").setEnabled(false);this.byId("id_ApproveRadio").setEnabled(true);this.byId("id_ApproveRadio").setSelected(true);this.selectedOption="Approve";const e=this.byId("saveAndProceed");e.setText("Send for Approval");const t=this.getOwnerComponent().getModel();const s=t.bindContext(`/TravelRequests(${this.travelId})`);s.requestObject().then(e=>{console.log("Single travel request data:",e);const t=new sap.ui.model.json.JSONModel(e);this.getOwnerComponent().setModel(t,"travelData");console.log(t)}).catch(e=>{console.error("Failed to fetch specific travel request:",e);sap.m.MessageBox.error("Error fetching data.")})}else{const e=this.getOwnerComponent().getModel("travelData");console.log("traveiID "+this.travelId);console.log(e);this.byId("id_saveDraftRadio").setEnabled(true);this.byId("id_saveAndApproveRadio").setEnabled(true);this.byId("id_ApproveRadio").setEnabled(false);this.byId("id_saveAndApproveRadio").setSelected(true);this.selectedOption="SaveApprove";const t=this.byId("saveAndProceed");t.setText("Save and Send for Approval")}const t=this.getOwnerComponent().getModel("travelData");console.log("travelData");console.log(t);const s=t.getProperty("/startDate");console.log("formattedStartdate: "+s)},onActionSelect:function(e){const t=e.getParameter("selectedIndex");const s=this.byId("saveAndProceed");if(t===0){s.setText("Save Draft");this.selectedOption="draft"}else if(t===1){s.setText("Save and Send for Approval");this.selectedOption="SaveApprove"}else{s.setText("Send for Approval");this.selectedOption="Approve"}},onSaveAndApprove:function(){if(this.selectedOption==="Approve"){sap.m.MessageToast.show("Travel request "+n+" is send for approval.")}else{this.getView().setBusy(true);var e=this.getView().getModel();const l=this.getOwnerComponent().getModel("travelData");const p=l.getProperty("/startDate");const v=l.getProperty("/endDate");var t=l.getProperty("/departure");var s=l.getProperty("/arrival");const c=l.getProperty("/postingDate");const g=l.getProperty("/selfTravel");const u=l.getProperty("/placeOfVisit");var o=l.getProperty("/estimatedCost");var r=l.getProperty("/travelType");var a=l.getProperty("/purposeOfTravel");const h=l.getProperty("/additionalTravellers");const f=l.getProperty("/advances");const y=l.getProperty("/costAssignment");var n=crypto.randomUUID();var i="Approve";var d=e.bindList("/TravelRequests",undefined,undefined,undefined,{$$updateGroupId:"travelGroup"});d.create({ID:n,employee:"EMP001",startDate:p,endDate:v,postingDate:c,selfTravel:g,placeOfVisit:u,estimatedCost:o,action:1,createdAt:(new Date).toISOString(),departure:t,arrival:s,travelType:r,purposeOfTravel:a,additionalTravellers:h,advances:f,costAssignment:y,status:i});e.submitBatch("travelGroup").then(()=>{if(this.selectedOption==="draft"){sap.m.MessageToast.show("Travel request "+n+" is saved successfully.")}else if(this.selectedOption==="SaveApprove"){sap.m.MessageToast.show("Travel request "+n+" is saved successfully and send for approval.")}else if(this.selectedOption==="Approve"){sap.m.MessageToast.show("Travel request "+n+" is send for approval.")}}).catch(e=>{sap.m.MessageBox.error("Error saving travel request: "+e.message)}).finally(()=>{this.getView().setBusy(false)})}}})});
//# sourceMappingURL=ReviewTravelScreen.controller.js.map