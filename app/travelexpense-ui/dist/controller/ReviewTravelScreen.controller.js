sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/model/odata/v4/ODataModel"],function(e,t,a){"use strict";return e.extend("travel.travelexpenseui.controller.ReviewTravelScreen",{onInit:function(){this.getOwnerComponent().getRouter().getRoute("ReviewTravelScreen").attachPatternMatched(this._onRouteMatched,this)},onPreviousStep:function(){var e=sap.ui.core.routing.History.getInstance();var t=e.getPreviousHash();if(t!==undefined){window.history.go(-1)}else{this.getOwnerComponent().getRouter().navTo("RouteCreateTravelRequest",true)}},_onRouteMatched:function(e){this.travelId=e.getParameter("arguments").travelId;console.log("Loaded Travel ID:",this.travelId);if(this.travelId!=="-"){this.byId("id_saveDraftRadio").setEnabled(false);this.byId("id_saveAndApproveRadio").setEnabled(false);this.byId("id_ApproveRadio").setEnabled(true);this.byId("id_ApproveRadio").setSelected(true);this.selectedOption="Approve";const e=this.byId("saveAndProceed");e.setText("Send for Approval");const t=this.getOwnerComponent().getModel();const a=t.bindContext(`/TravelRequests(${this.travelId})`);a.requestObject().then(e=>{console.log("Single travel request data:",e);const t=new sap.ui.model.json.JSONModel(e);this.getOwnerComponent().setModel(t,"travelData");console.log(t)}).catch(e=>{console.error("Failed to fetch specific travel request:",e);sap.m.MessageBox.error("Error fetching data.")})}else{const e=this.getOwnerComponent().getModel("travelData");console.log("traveiID "+this.travelId);console.log(e);this.byId("id_saveDraftRadio").setEnabled(true);this.byId("id_saveAndApproveRadio").setEnabled(true);this.byId("id_ApproveRadio").setEnabled(false);this.byId("id_saveAndApproveRadio").setSelected(true);this.selectedOption="SaveApprove";const t=this.byId("saveAndProceed");t.setText("Save and Send for Approval")}const t=this.getOwnerComponent().getModel("travelData");console.log("travelData");console.log(t);const a=t.getProperty("/startDate");console.log("formattedStartdate: "+a)},onActionSelect:function(e){const t=e.getParameter("selectedIndex");const a=this.byId("saveAndProceed");if(t===0){a.setText("Save Draft");this.selectedOption="draft"}else if(t===1){a.setText("Save and Send for Approval");this.selectedOption="SaveApprove"}else{a.setText("Send for Approval");this.selectedOption="Approve"}},onSaveAndApprove:async function(){const e=this.getOwnerComponent().getModel("travelData");const t=e.getProperty("/startDate");const a=e.getProperty("/endDate");var s=e.getProperty("/departure");var r=e.getProperty("/arrival");const o=e.getProperty("/postingDate");const n=e.getProperty("/selfTravel");const i=e.getProperty("/placeOfVisit");var l=e.getProperty("/estimatedCost");var d=e.getProperty("/travelType");var p=e.getProperty("/purposeOfTravel");const v=e.getProperty("/additionalTravellers");const c=e.getProperty("/advances");const u=e.getProperty("/costAssignment");var g=crypto.randomUUID();var f="Approve";if(this.selectedOption==="Approve"){const e={id:g,employee:"EMP001",startdate:t,enddate:a,postingdate:o,selftravel:n,placeofvisit:i,estimatedcost:l,action:"1",createdat:(new Date).toISOString(),departure:s,arrival:r,traveltype:d,purposeoftravel:p,additionaltravellers:v,advances:c,costassignment:u,status:f};$.ajax({url:"/odata/v4/travel/startTravelWorkflow",method:"POST",contentType:"application/json",data:JSON.stringify({travelData:JSON.stringify(e)}),success:function(e){sap.m.MessageToast.show("Travel request "+g+" is send for approval.")},error:function(e,t,a){sap.m.MessageBox.error("Failed to start workflow: "+e.responseText)}})}else if(this.selectedOption==="draft"){this.getView().setBusy(true);var h=this.getView().getModel();var y=h.bindList("/TravelRequests",undefined,undefined,undefined,{$$updateGroupId:"travelGroup"});y.create({ID:g,employee:"EMP001",startDate:t,endDate:a,postingDate:o,selfTravel:n,placeOfVisit:i,estimatedCost:l,action:1,createdAt:(new Date).toISOString(),departure:s,arrival:r,travelType:d,purposeOfTravel:p,additionalTravellers:v,advances:c,costAssignment:u,status:f});h.submitBatch("travelGroup").then(()=>{if(this.selectedOption==="draft"){sap.m.MessageToast.show("Travel request "+g+" is saved successfully.")}else if(this.selectedOption==="SaveApprove"){sap.m.MessageToast.show("Travel request "+g+" is saved successfully and send for approval.")}else if(this.selectedOption==="Approve"){sap.m.MessageToast.show("Travel request "+g+" is send for approval.")}}).catch(e=>{sap.m.MessageBox.error("Error saving travel request: "+e.message)}).finally(()=>{this.getView().setBusy(false)})}else if(this.selectedOption==="SaveApprove"){this.getView().setBusy(true);var h=this.getView().getModel();var y=h.bindList("/TravelRequests",undefined,undefined,undefined,{$$updateGroupId:"travelGroup"});y.create({ID:g,employee:"EMP001",startDate:t,endDate:a,postingDate:o,selfTravel:n,placeOfVisit:i,estimatedCost:l,action:1,createdAt:(new Date).toISOString(),departure:s,arrival:r,travelType:d,purposeOfTravel:p,additionalTravellers:v,advances:c,costAssignment:u,status:f});h.submitBatch("travelGroup").then(()=>{const e={id:g,employee:"EMP001",startdate:t,enddate:a,postingdate:o,selftravel:n,placeofvisit:i,estimatedcost:l,action:"1",createdat:(new Date).toISOString(),departure:s,arrival:r,traveltype:d,purposeoftravel:p,additionaltravellers:v,advances:c,costassignment:u,status:f};$.ajax({url:"/odata/v4/travel/startTravelWorkflow",method:"POST",contentType:"application/json",data:JSON.stringify({travelData:JSON.stringify(e)}),success:function(e){sap.m.MessageToast.show("Travel request "+g+" is saved and send for approval.")},error:function(e,t,a){sap.m.MessageBox.error("Failed to start workflow: "+e.responseText)}})}).catch(e=>{sap.m.MessageBox.error("Error saving travel request: "+e.message)}).finally(()=>{this.getView().setBusy(false)})}}})});
//# sourceMappingURL=ReviewTravelScreen.controller.js.map